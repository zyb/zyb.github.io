<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="begin..."><title>Jstorm接口开发之HelloWorld | zyb</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Jstorm接口开发之HelloWorld</h1><a id="logo" href="/.">zyb</a><p class="description">zybrc</p></div><div id="nav-menu"><a href="/"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/md.html"><i class="fa null"> mdedit</i></a><a href="/404.html"><i class="fa null"> 404page</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Jstorm接口开发之HelloWorld</h1><div class="post-meta">Dec 12, 2016<span> | </span><span class="category"><a href="/categories/大数据/">大数据</a></span></div><div class="post-content"><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>Jstorm版本2.1.1</li>
<li>JDK版本1.7</li>
<li>archlinux x64操作系统</li>
</ul>
<h2 id="Jstorm概述"><a href="#Jstorm概述" class="headerlink" title="Jstorm概述"></a>Jstorm概述</h2><p>从应用的角度来说，JStorm它是一种分布式的应用；从系统层面来说，它又类似于MapReduce这样的调度系统；而从数据方面来说，它又 是一种基于流水数据的实时处理解决方案。如今，DT时代的当下，用户和企业也不仅仅只满足于离线数据，对于数据的实时性要求也越来越高了。</p>
<p>在早期，Storm和JStorm未问世之前，业界有很多实时计算系统，可谓百家争鸣，自Storm和JStorm出世之后，基本这两者占据主要地位，原因如下：</p>
<ul>
<li>易开发：接口简单，上手容易，只需要按照Spout，Bolt以及Topology的编程规范即可开发一个扩展性良好的应用，底层的细节我们可以不用去深究其原因。</li>
<li>扩展性：可线性扩展性能。</li>
<li>容错：当Worker异常或挂起，会自动分配新的Worker去工作。</li>
<li>数据精准：其包含Ack机制，规避了数据丢失的风险。使用事物机制，提高数据精度。</li>
</ul>
<p>JStorm处理数据的方式流程是基于流式处理，因此，我们会用它做以下处理：</p>
<ul>
<li>日志分析：从收集的日志当中，统计出特定的数据结果，并将统计后的结果持久化到外界存储介质中，如：DB。当下，实时统计主流使用JStorm和Storm。</li>
<li>消息转移：将接受的消息进行Filter后，定向的存储到另外的消息中间件中。</li>
</ul>
<h2 id="基本术语"><a href="#基本术语" class="headerlink" title="基本术语"></a>基本术语</h2><p>Storm通过一系列基本元素实现实时计算的目标，其中包括了Topology、Stream、Spout、Bolt、Tuple、worker、task、slot。</p>
<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p>在JStorm当中，有对Stream的抽象，它是一个不间断的无界的连续Tuple，而JStorm在建模事件流时，把流中的事件抽象为Tuple。</p>
<p><img src="http://images2015.cnblogs.com/blog/666745/201509/666745-20150915135843351-643602897.png" alt=""></p>
<h3 id="Spout"><a href="#Spout" class="headerlink" title="Spout"></a>Spout</h3><p>在JStorm中，它认为每个Stream都有一个Stream的来源，即Tuple的源头，所以它将这个源头抽象为Spout，而Spout可能是一个消息中间件，如：MQ，Kafka等。并不断的发出消息，也可能是从某个队列中不断读取队列的元数据。</p>
<p>在有了Spout后，接下来如何去处理相关内容，以类似的思想，将JStorm的处理过程抽象为Bolt，Bolt可以消费任意数量的输入流， 只要将流方向导到该Bolt即可，同时，它也可以发送新的流给其他的Bolt使用，因而，我们只需要开启特定的Spout，将Spout流出的Tuple 导向特定的Bolt，然后Bolt对导入的流做处理后再导向其它的Bolt等。</p>
<p>那么，通过上述描述，其实，我们可以用一个形象的比喻来理解这个流程。我们可以认为Spout就是一个个的水龙头，并且每个水龙头中的水是不同的，我们想要消费那种水就去开启对应的水龙头，然后使用管道将水龙头中的水导向一个水处理器，即Bolt，水处理器处理完后会再使用管道导向到另外的处理器或者落地到存储介质。</p>
<p><img src="http://images2015.cnblogs.com/blog/666745/201509/666745-20150915140959179-1408063851.png" alt=""></p>
<h3 id="Topology"><a href="#Topology" class="headerlink" title="Topology"></a>Topology</h3><p>实时计算任务需要打包成Topology提交，计算任务Topology是由不同的Spout和Bolt通过Stream连接起来的DAG图，它是JStorm中最高层次的一个抽象概念，一个Topology即为一个数据流转换图，图中的每个节点是一个 Spout或者Bolt，当Spout或Bolt发送Tuple到流时，它就发送Tuple到每个订阅了该流的Bolt上。</p>
<p><img src="http://images2015.cnblogs.com/blog/666745/201509/666745-20150915141401726-976011955.png" alt=""></p>
<h3 id="Tuple"><a href="#Tuple" class="headerlink" title="Tuple"></a>Tuple</h3><p>JStorm当中将Stream中数据抽象为了Tuple，一个Tuple就是一个Value List，List值的每个Value都有一个Name，并且该Value可以是基本类型，字符类型，字节数组等，当然也可以是其它可序列化的类型。 Topology的每个节点都要说明它所发射出的Tuple的字段的Name，其它节点只需要订阅该Name就可以接收处理相应的内容。</p>
<h3 id="Worker和Task"><a href="#Worker和Task" class="headerlink" title="Worker和Task"></a>Worker和Task</h3><p>Work和Task在JStorm中的职责是一个执行单元，一个Worker表示一个进程，一个Task表示一个线程，一个Worker可以运行多个Task，一个Worker中的Task必须属于同一个Topology。</p>
<p>Worker可以通过setNumWorkers(int workers)方法来设置对应的数目，表示这个Topology运行在多个JVM（PS：一个JVM为一个进程，即一个Worker）；另外 setSpout(String id, IRichSpout spout, Number parallelism_hint)和setBolt(String id, IRichBolt bolt,Number parallelism_hint)方法中的参数parallelism_hint代表这样一个Spout或Bolt有多少个实例，即对应多少个线程，一 个实例对应一个线程。</p>
<h3 id="Slot"><a href="#Slot" class="headerlink" title="Slot"></a>Slot</h3><p>在JStorm当中，Slot的类型分为四种，他们分别是：CPU，Memory，Disk，Port；与Storm有所区别（Storm局限 于Port）。一个Supervisor可以提供的对象有：CPU Slot、Memory Slot、Disk Slot以及Port Slot。</p>
<ul>
<li>在JStorm中，一个Worker消耗一个Port Slot，默认一个Task会消耗一个CPU Slot和一个Memory Slot。</li>
<li>在Task执行较多的任务时，可以申请更多的CPU Slot。</li>
<li>在Task需要更多的内存时，可以申请更多的额Memory Slot。</li>
<li>在Task磁盘IO较多时，可以申请Disk Slot。</li>
</ul>
<h2 id="Jstorm架构"><a href="#Jstorm架构" class="headerlink" title="Jstorm架构"></a>Jstorm架构</h2><p>从设计层面来说，JStorm是一个典型的调度系统。架构如下：</p>
<p><img src="/uploads/jstorm-framework.png" alt=""></p>
<ul>
<li>ZooKeeper：系统的协调者</li>
<li>Nimbus：调度器</li>
<li>Supervisor：Worker的代理角色，负责Kill掉Worker和运行Worker</li>
<li>Worker：一个JVM进程，Task的容器</li>
<li>Task：一个线程，任务的执行者</li>
</ul>
<h2 id="Jstorm接口开发——Topology"><a href="#Jstorm接口开发——Topology" class="headerlink" title="Jstorm接口开发——Topology"></a>Jstorm接口开发——Topology</h2><p>Topology的开发基本也有一些套路，根据官方的一些Example，总结了一个Topology基类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfDefTopologyImp</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">protected</span> Map conf = <span class="keyword">new</span> HashMap&lt;Object, Object&gt;();</div><div class="line"></div><div class="line">  <span class="comment">// TopologyBuilder设置接口，不同的Topology实现这个接口</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">SetBuilder</span><span class="params">(TopologyBuilder builder, Map conf)</span></span>;</div><div class="line"></div><div class="line">  <span class="comment">// 本地模式启动：</span></div><div class="line">  <span class="comment">// 1、通过配置文件获取Toplogy Name</span></div><div class="line">  <span class="comment">// 2、通过setBuild抽象接口设置TopologyBuilder</span></div><div class="line">  <span class="comment">// 3、以本地模式启动任务</span></div><div class="line">  <span class="comment">// 4、本地调试模式根据调试时间，最终关闭本地模式</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SetLocalTopology</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    String tname = (String) conf.get(Config.TOPOLOGY_NAME);</div><div class="line">    <span class="keyword">if</span> (tname == <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Toplogy Name is null"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    TopologyBuilder builder = <span class="keyword">new</span> TopologyBuilder();</div><div class="line">    SetBuilder(builder, conf);</div><div class="line"></div><div class="line">    LocalCluster cluster = <span class="keyword">new</span> LocalCluster();</div><div class="line">    cluster.submitTopology(tname, conf, builder.createTopology());</div><div class="line"></div><div class="line">    Thread.sleep(<span class="number">60000</span>);</div><div class="line">    cluster.killTopology(tname);</div><div class="line">    cluster.shutdown();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 集群模式启动：</span></div><div class="line">  <span class="comment">// 1、通过配置文件获取Toplogy Name</span></div><div class="line">  <span class="comment">// 2、通过setBuild抽象接口设置TopologyBuilder</span></div><div class="line">  <span class="comment">// 3、向集群提交任务</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SetRemoteTopology</span><span class="params">()</span> <span class="keyword">throws</span> AlreadyAliveException,</span></div><div class="line">      InvalidTopologyException &#123;</div><div class="line">    String tname = (String) conf.get(Config.TOPOLOGY_NAME);</div><div class="line">    <span class="keyword">if</span> (tname == <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Toplogy Name is null"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    TopologyBuilder builder = <span class="keyword">new</span> TopologyBuilder();</div><div class="line">    SetBuilder(builder, conf);</div><div class="line"></div><div class="line">    conf.put(Config.STORM_CLUSTER_MODE, <span class="string">"distributed"</span>);</div><div class="line"></div><div class="line">    StormSubmitter.submitTopology(tname, conf, builder.createTopology());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">LoadConf</span><span class="params">(String arg)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (arg.endsWith(<span class="string">"yaml"</span>)) &#123;</div><div class="line">      conf = LoadConf.LoadYaml(arg);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      conf = LoadConf.LoadProperty(arg);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 根据配置文件判断启动模式是‘本地模式’或‘集群模式’</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">local_mode</span><span class="params">(Map conf)</span> </span>&#123;</div><div class="line">    String mode = (String) conf.get(Config.STORM_CLUSTER_MODE);</div><div class="line">    <span class="keyword">if</span> (mode != <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="keyword">if</span> (mode.equals(<span class="string">"local"</span>)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 主入口：1、加载配置文件；2、根据配置文件中‘本地模式’或‘集群模式’的配置，分别启动</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String cfile)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="keyword">if</span> (StringUtils.isBlank(cfile)) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"params invalid."</span>);</div><div class="line"></div><div class="line">    LoadConf(cfile);</div><div class="line">    <span class="keyword">if</span> (local_mode(conf)) &#123;</div><div class="line">      SetLocalTopology();</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      SetRemoteTopology();</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>最主要的就是SetBuilder()这个接口，直接通过这个接口配置TopologyBuilder即可。</li>
<li>SelfDefTopologyImp主要封装了配置读取，本地模式和集群模式启动，其他细节参考代码。</li>
</ul>
</blockquote>
<p>HelloTopology类继承SelfDefTopologyImp，具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloTopology</span> <span class="keyword">extends</span> <span class="title">SelfDefTopologyImp</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetBuilder</span><span class="params">(TopologyBuilder builder, Map conf)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// 从配置文件中读取spout和bolt的并行数</span></div><div class="line">    <span class="keyword">int</span> spout_Parallelism_hint = JStormUtils.parseInt(conf.get(<span class="string">"topology.spout.parallel"</span>), <span class="number">1</span>);</div><div class="line">    <span class="keyword">int</span> bolt_Parallelism_hint = JStormUtils.parseInt(conf.get(<span class="string">"topology.bolt.parallel"</span>), <span class="number">1</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 设置spout和bolt的名称</span></div><div class="line">    String spoutName = HelloSpout.class.getSimpleName();</div><div class="line">    String boltName = HelloBolt.class.getSimpleName();</div><div class="line"></div><div class="line">    <span class="comment">// 设置spout和bolt，其中shuffleGrouping指明了HelloBolt接收HelloSpout的数据</span></div><div class="line">    <span class="comment">// 这里的设置最终就是Topology的DAG图</span></div><div class="line">    builder.setSpout(spoutName, <span class="keyword">new</span> HelloSpout(), spout_Parallelism_hint);</div><div class="line">    builder.setBolt(boltName, <span class="keyword">new</span> HelloBolt(), bolt_Parallelism_hint).shuffleGrouping(spoutName);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Jstorm接口开发——Spout"><a href="#Jstorm接口开发——Spout" class="headerlink" title="Jstorm接口开发——Spout"></a>Jstorm接口开发——Spout</h2><p>HelloSpout实现的功能是：每秒生成一个随机数，并向后传递。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloSpout</span> <span class="keyword">extends</span> <span class="title">BaseRichSpout</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> SpoutOutputCollector collector;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Random rand;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Map conf, TopologyContext context, SpoutOutputCollector collector)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.collector = collector;</div><div class="line">    <span class="keyword">this</span>.rand = <span class="keyword">new</span> Random();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">nextTuple</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> r = rand.nextInt(<span class="number">9999</span>);</div><div class="line">    collector.emit(<span class="keyword">new</span> Values(r));</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      Thread.sleep(<span class="number">1000</span>);</div><div class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">      e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">declareOutputFields</span><span class="params">(OutputFieldsDeclarer declarer)</span> </span>&#123;</div><div class="line">    declarer.declare(<span class="keyword">new</span> Fields(<span class="string">"value"</span>));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Jstorm接口开发——Bolt"><a href="#Jstorm接口开发——Bolt" class="headerlink" title="Jstorm接口开发——Bolt"></a>Jstorm接口开发——Bolt</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloBolt</span> <span class="keyword">extends</span> <span class="title">BaseBasicBolt</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(Map stormConf, TopologyContext context)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.prepare(stormConf, context);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Tuple input, BasicOutputCollector collector)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n = input.getIntegerByField(<span class="string">"value"</span>);</div><div class="line">    System.out.println();</div><div class="line">    System.out.println(<span class="string">"==========================="</span>);</div><div class="line">    System.out.println(<span class="string">"value: "</span> + n);</div><div class="line">    System.out.println(<span class="string">"==========================="</span>);</div><div class="line">    System.out.println();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">declareOutputFields</span><span class="params">(OutputFieldsDeclarer declarer)</span> </span>&#123;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Jstorm运行接口开发——主函数"><a href="#Jstorm运行接口开发——主函数" class="headerlink" title="Jstorm运行接口开发——主函数"></a>Jstorm运行接口开发——主函数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JstormHelloWorld</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">    <span class="keyword">if</span> (args.length == <span class="number">0</span>) &#123;</div><div class="line">      System.err.println(<span class="string">"Please input configuration file"</span>);</div><div class="line">      System.exit(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    (<span class="keyword">new</span> HelloTopology()).run(args[<span class="number">0</span>]);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Jstorm任务配置"><a href="#Jstorm任务配置" class="headerlink" title="Jstorm任务配置"></a>Jstorm任务配置</h2><p>配置文件如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 集群模式还是本地模式</span></div><div class="line">storm.cluster.mode: <span class="string">"local"</span></div><div class="line"><span class="comment">#storm.cluster.mode: "distributed"</span></div><div class="line"></div><div class="line"><span class="comment"># topology名称配置</span></div><div class="line">topology.name: <span class="string">"JstormHelloWorld"</span></div><div class="line"></div><div class="line"><span class="comment"># spout和bolt的并行数配置</span></div><div class="line">topology.spout.parallel: <span class="number">1</span></div><div class="line">topology.bolt.parallel: <span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="Jstorm任务提交"><a href="#Jstorm任务提交" class="headerlink" title="Jstorm任务提交"></a>Jstorm任务提交</h2><p>本地运行命令如下，conf/jstormHelloWorld.yaml是配置文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ java -cp JstormHelloWorld-1.0.0-jar-with-dependencies.jar io.github.zyb.jstorm.JstormHelloWorld conf/jstormHelloWorld.yaml</div></pre></td></tr></table></figure>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul>
<li><p>Jstorm提交的Topology的名称中不能包含空格，准确来说名称应符合的正则表达式为”[a-zA-Z0-9-_.]+”</p>
</li>
<li><p><strong>重要提醒</strong>：Jstorm开发中pom.xml配置依赖jstorm-core，在集群模式下需要这个包的配置是provided，但是在本地运行模式下又需要是非provided，也就是本地模式要配置如下，集群模式需要去掉注视：</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.jstorm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstorm-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- &lt;scope&gt;provided&lt;/scope&gt; --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://yq.aliyun.com/articles/34083" target="_blank" rel="external">JStorm－介绍</a> <strong>强烈推荐，入门先看</strong> 本文多出引用来自于此<br><a href="https://github.com/alibaba/jstorm/blob/2.1.1/example/sequence-split-merge/src/main/java/com/alipay/dw/jstorm/example/sequence" target="_blank" rel="external">Jstorm Example</a> 本文示例部分代码参考于此<br><a href="http://blog.csdn.net/szzhaom/article/details/41792023" target="_blank" rel="external">JStorm - Hello Word</a> 本文示例部分代码参考于此<br><a href="http://www.voidcn.com/blog/wwwxxdddx/article/p-4881831.html" target="_blank" rel="external">JStorm介绍</a> <strong>强烈推荐，入门先看</strong><br><a href="http://www.voidcn.com/blog/wwwxxdddx/article/p-4881832.html" target="_blank" rel="external">JStorm之Nimbus简介</a> <strong>入门先看</strong><br><a href="http://www.voidcn.com/blog/wwwxxdddx/article/p-4881833.html" target="_blank" rel="external">JStorm之Supervisor简介</a> <strong>入门先看</strong><br><a href="http://jstorm.io/quickstart_cn/Example.html" target="_blank" rel="external">Jstorm官方Example</a>官网示例，基本没怎么参考，无力吐槽…<br><a href="https://github.com/alibaba/jstorm/wiki/JStorm-Chinese-Documentation" target="_blank" rel="external">Jstorm Github Wiki</a><br><a href="https://github.com/alibaba/jstorm/wiki/%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" target="_blank" rel="external">Jstorm基本概念</a></p>
<h2 id="拓展阅读"><a href="#拓展阅读" class="headerlink" title="拓展阅读"></a>拓展阅读</h2><p><a href="https://yq.aliyun.com/articles/66098?spm=5176.100240.searchblog.22.FjBOiE" target="_blank" rel="external">双11媒体大屏背后的数据技术与产品 </a><br><a href="https://yq.aliyun.com/articles/62693?spm=5176.100240.searchblog.36.FjBOiE" target="_blank" rel="external">JStorm，让大规模流处理成为可能 </a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://zyb.github.io/2016/12/12-jstorm-hello.html" data-id="ciwnllg0k000g77ghyu8248yo" class="article-share-link">分享到</a><div class="tags"><a href="/tags/jstorm/">jstorm</a></div><div class="post-nav"><a href="/2016/12/11-pig-trap.html" class="next">apache Pig踩坑之旅（以及pig特性描述）</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/hello/">hello</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">6</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/jstorm/" style="font-size: 15px;">jstorm</a> <a href="/tags/pig/" style="font-size: 15px;">pig</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/12-jstorm-hello.html">Jstorm接口开发之HelloWorld</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11-pig-trap.html">apache Pig踩坑之旅（以及pig特性描述）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10-cdh-hadoop-compile.html">CDH5.7.2 Hadoop源码编译</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/09-jstorm-webui-install.html">Jstorm Web UI 安装部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/07-jstorm-install.html">Jstorm从源码编译及配置部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/06-zookeeper-install.html">Zookeeper从源码编译及配置部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/06-hello-world.html">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="mailto:389808013@qq.com" title="Contact Me： 389808013@qq.com" target="_blank">Contact Me： 389808013@qq.com</a><ul></ul><a href="http://weibo.com/zybs" title="Weibo： weibo.com/zybs" target="_blank">Weibo： weibo.com/zybs</a><ul></ul><a href="https://github.com/zyb" title="Github： github.com/zyb" target="_blank">Github： github.com/zyb</a><ul></ul><a href="http://coolshell.cn/" title="Coolshell" target="_blank">Coolshell</a><ul></ul><a href="https://github.com/tufu9441/maupassant-hexo" title="maupassant-hexo" target="_blank">maupassant-hexo</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">zyb.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>