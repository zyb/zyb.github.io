<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="begin..."><title>CDH5.7.2 Hadoop源码编译 | zyb</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CDH5.7.2 Hadoop源码编译</h1><a id="logo" href="/.">zyb</a><p class="description">zybrc</p></div><div id="nav-menu"><a href="/"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/md.html"><i class="fa null"> mdedit</i></a><a href="/404.html"><i class="fa null"> 404page</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CDH5.7.2 Hadoop源码编译</h1><div class="post-meta">Dec 10, 2016<span> | </span><span class="category"><a href="/categories/大数据/">大数据</a></span></div><div class="post-content"><h2 id="一、环境"><a href="#一、环境" class="headerlink" title="一、环境"></a>一、环境</h2><ul>
<li>Hadoop源码为Cloudera的5.7.2版本，这个版本源于Hadoop官方2.6.0版本</li>
<li>JDK版本为1.7</li>
<li>archlinux x64操作系统</li>
</ul>
<h2 id="二、CDH5-Hadoop源码下载"><a href="#二、CDH5-Hadoop源码下载" class="headerlink" title="二、CDH5 Hadoop源码下载"></a>二、CDH5 Hadoop源码下载</h2><p>CDH是Cloudera开源组件的集合，Hadoop只是其中一个，Cloudera的源码并没有在github或其他类似的工具上维护，而是CDH的每个版本Cloudera都提供了源码下载包，都在 <a href="http://archive.cloudera.com/xxxx" target="_blank" rel="external">http://archive.cloudera.com/xxxx</a> 中，’xxxx’表示具体的子路径。具体如下：</p>
<p>CDH3及以前的版本在 <a href="http://archive.cloudera.com/cdh" target="_blank" rel="external">http://archive.cloudera.com/cdh</a> 中<br>CDH4版本在 <a href="http://archive.cloudera.com/cdh4" target="_blank" rel="external">http://archive.cloudera.com/cdh4</a> 中<br>CDH5版本在 <a href="http://archive.cloudera.com/cdh5" target="_blank" rel="external">http://archive.cloudera.com/cdh5</a> 中</p>
<p>下载CDH5.7.2 Hadoop：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ wget http://archive.cloudera.com/cdh5/cdh/5/hadoop-2.6.0-cdh5.7.2-src.tar.gz</div></pre></td></tr></table></figure>
<h2 id="三、CDH5-Hadoop源码编译"><a href="#三、CDH5-Hadoop源码编译" class="headerlink" title="三、CDH5 Hadoop源码编译"></a>三、CDH5 Hadoop源码编译</h2><p>CDH5.7.2版本的Hadoop依赖的protobuf是2.5.0版本，有两种方式：</p>
<ol>
<li>将系统的protobuf版本替换为2.5.0版本。</li>
<li>如果当前开发系统还在用其它版本的protobuf，不想替换系统protobuf的，也可以设置到非系统环境目录下。通过github下载源码自行编译一个版本，或者下载别人编译好的2.5.0版本。但是如果是下载或者自行编译，假设protobuf的主目录是PROTOBUF_HOME，那么protoc的路径需要保证为’PROTOBUF_HOME/bin/protoc’，这个是后续用Cloudera的编译脚本执行是需要设置的，自行编译参考下面方法：</li>
</ol>
<h4 id="protobuf编译"><a href="#protobuf编译" class="headerlink" title="protobuf编译"></a>protobuf编译</h4><p>protobuf需要自己编译，将下面%PROTOBUF_COMPILE_PATH%替换成你自己的protobuf所在的目录，：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> %PROTOBUF_COMPILE_PATH%</div><div class="line">$ wget https://github.com/google/protobuf/releases/download/v2.5.0/protobuf-2.5.0.tar.gz</div><div class="line">$ <span class="built_in">cd</span> protobuf-2.5.0</div><div class="line">$ ./configure --prefix=%PROTOBUF_COMPILE_PATH%/protobuf-2.5.0 <span class="comment"># 设置prefix非常重要，否则在'make install'会替换系统中的protoc</span></div><div class="line">$ make</div><div class="line">$ make install</div></pre></td></tr></table></figure>
<p>最终protoc生成位置为 %PROTOBUF_COMPILE_PATH%/protobuf-2.5.0/bin/protoc</p>
<h4 id="Hadoop源码编译"><a href="#Hadoop源码编译" class="headerlink" title="Hadoop源码编译"></a>Hadoop源码编译</h4><blockquote>
<ul>
<li>Hadoop的编译除了jdk和protoc还依赖maven、ant。</li>
<li>编译之前先修改./build.sh和./lib.sh中的第二行’set -xe’注释掉，这个是shell脚本设置的调试参数。</li>
<li><strong>重要提醒</strong>：本次编译修改了lib.sh中的’MAVEN_FLAGS’，由于本机编译hadoop的hadoop-mapreduce-client-nativetask项目失败，因此需要去掉’-Pnative’参数。后续尝试成功之后再记录。</li>
</ul>
</blockquote>
<p>将下载的hadoop源码包拷贝到编译的路径下，我本地环境protobuf 2.5.0版的路径在跟’hadoop-2.6.0-cdh5.7.2’目录处于同一级目录，根据以下命令编译Hadoop：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ tar zxf hadoop-2.6.0-cdh5.7.2-src.tar.gz</div><div class="line">$ <span class="built_in">cd</span> hadoop-2.6.0-cdh5.7.2</div><div class="line">$ <span class="built_in">cd</span> cloudera</div><div class="line">$ <span class="comment"># ./build.sh --protobuf-home=../../protobuf-2.5.0 # 这种方式尝试失败，直接将本机的protobuf从3.0降到2.5.0，然后就不需要设置protobuf-home这个参数了</span></div><div class="line">$ ./build.sh</div></pre></td></tr></table></figure>
<p>（未完待续…）</p>
<h2 id="四、参考资料"><a href="#四、参考资料" class="headerlink" title="四、参考资料"></a>四、参考资料</h2><p>无</p>
<blockquote>
<p>对于hadoop-mapreduce-client-nativetask项目native模式下失败，在github上看到一个同样的问题<a href="https://github.com/protegeproject/protege/issues/514" target="_blank" rel="external">https://github.com/protegeproject/protege/issues/514</a>，回复了对方，等待对方回复，看看对方现在是否已经解决。</p>
</blockquote>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://zyb.github.io/2016/12/10-cdh-hadoop-compile.html" data-id="ciwnln8ga00013wghp130cp44" class="article-share-link">分享到</a><div class="tags"><a href="/tags/hadoop/">hadoop</a></div><div class="post-nav"><a href="/2016/12/11-pig-trap.html" class="pre">apache Pig踩坑之旅（以及pig特性描述）</a><a href="/2016/12/09-jstorm-webui-install.html" class="next">Jstorm Web UI 安装部署</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/hello/">hello</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">6</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/jstorm/" style="font-size: 15px;">jstorm</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/pig/" style="font-size: 15px;">pig</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/12-jstorm-hello.html">Jstorm接口开发之HelloWorld</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11-pig-trap.html">apache Pig踩坑之旅（以及pig特性描述）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10-cdh-hadoop-compile.html">CDH5.7.2 Hadoop源码编译</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/09-jstorm-webui-install.html">Jstorm Web UI 安装部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/07-jstorm-install.html">Jstorm从源码编译及配置部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/06-zookeeper-install.html">Zookeeper从源码编译及配置部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/06-hello-world.html">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="mailto:389808013@qq.com" title="Contact Me： 389808013@qq.com" target="_blank">Contact Me： 389808013@qq.com</a><ul></ul><a href="http://weibo.com/zybs" title="Weibo： weibo.com/zybs" target="_blank">Weibo： weibo.com/zybs</a><ul></ul><a href="https://github.com/zyb" title="Github： github.com/zyb" target="_blank">Github： github.com/zyb</a><ul></ul><a href="http://coolshell.cn/" title="Coolshell" target="_blank">Coolshell</a><ul></ul><a href="https://github.com/tufu9441/maupassant-hexo" title="maupassant-hexo" target="_blank">maupassant-hexo</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">zyb.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>